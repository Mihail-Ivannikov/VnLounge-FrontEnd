# Сайт для завантаження візуальних новел VnLounge.

## Діаграма компонентів:

![components drawio (2)](https://github.com/user-attachments/assets/81f7df7e-3e76-4185-b132-5915862a8a6f)

# Опис Frontend(React)

Цей модуль складається з кількох сторінок, які взаємодіють з API для отримання даних та надання користувачам функціоналу для взаємодії з контентом. Ось основні сторінки та компоненти, що використовуються на них:

## Сторінки

### Home
На головній сторінці міститься кілька статичних компонентів, зокрема компонент **Catalog.tsx**, який відповідає за відображення каталогу візуальних новел. Цей компонент запитує дані з API та відображає їх у вигляді карток новел.

### LogIn
Сторінка входу надає форму для автентифікації користувачів. Компонент **LoginForm.tsx** здійснює взаємодію з API для входу за допомогою електронної пошти та пароля, а також надає можливість входу через Google OAuth.

### Register
Сторінка реєстрації дозволяє новим користувачам створити обліковий запис. Компонент **RegistrationForm.tsx** обробляє введення даних користувача (ім'я користувача, електронна пошта, пароль) і відправляє їх на сервер для реєстрації. Також є підтримка CAPTCHA для захисту від ботів.

### NovelPage
Сторінка візуальної новели взаємодіє з API для завантаження конкретної новели, яка відображається на сторінці. Компонент **NovelPage.tsx** відповідає за завантаження даних новели по ID та відображення її опису, рейтингу, жанру, а також надає користувачу можливість завантажити новелу.

## Компоненти

### Catalog.tsx
Компонент **Catalog.tsx** відповідає за отримання списку візуальних новел з API та їх відображення в каталозі. Данні з API мапуються у відповідні елементи карток.

### LoginForm.tsx
**LoginForm.tsx** надає користувачам форму для входу в систему через електронну пошту або через Google OAuth. Компонент обробляє введені дані та взаємодіє з API для автентифікації.

### RegistrationForm.tsx
Компонент **RegistrationForm.tsx** забезпечує процес реєстрації нового користувача, включаючи введення даних, перевірку CAPTCHA, і відправлення даних на сервер для створення нового облікового запису.

### NovelPage.tsx
Компонент **NovelPage.tsx** відповідає за завантаження та відображення інформації про одну конкретну новелу. Він отримує ID новели з URL та запитує відповідні дані з API для відображення їх на сторінці.

## Взаємодія з API
Усі компоненти, які взаємодіють з API, використовують асинхронні запити для отримання даних. Дані з API обробляються та відображаються в різних компонентах, що забезпечує інтерактивний досвід користувача на кожній з сторінок.

# Backend(NestJS)

# Модуль авторизації (Auth Module)

Модуль авторизації забезпечує автентифікацію користувачів за допомогою двох основних методів: локальної автентифікації (логін і пароль) та Google OAuth. Він містить контролери, сервіси, strategy та guard, які реалізують усі необхідні функціональності для забезпечення безпеки та інтеграції з іншими модулями системи.

## **Компоненти модуля**

### **AuthController**
Контролер для обробки HTTP-запитів, пов’язаних із авторизацією. Основні маршрути:
- `POST /auth/login`: Використовується для входу користувача за допомогою локальної автентифікації.
- `GET /auth/google`: Розпочинає процес авторизації через Google OAuth.
- `GET /auth/google/callback`: Обробляє перенаправлення після успішної авторизації через Google.
- `POST /auth/google/callback`: Приймає токен Google OAuth, перевіряє його та виконує вхід користувача.

### **AuthService**
Сервіс, який реалізує логіку для авторизації. Основні функції:
- **`validateUser(email: string, password: string)`**  
  Перевіряє, чи існує користувач із вказаними email та паролем.
- **`validateGoogleUser(googleId: string, email: string, username: string)`**  
  Валідує або створює нового користувача на основі Google ID.
- **`login(user: any)`**  
  Генерує JWT-токен для автентифікованого користувача.
- **`verifyGoogleToken(token: string)`**  
  Перевіряє достовірність Google токена та повертає інформацію про користувача.

### **LocalStrategy**
Реалізує стратегію локальної автентифікації:
- Використовує email як ім’я користувача.
- Валідує логін і пароль через `AuthService`.

### **GoogleStrategy**
Реалізує стратегію Google OAuth:
- Використовує `passport-google-oauth20` для інтеграції з Google.
- Викликає `AuthService` для валідації або створення користувача.

### **LocalAuthGuard**
перевіряє локальну автентифікацію:
- Використовує `LocalStrategy` для валідності облікових даних користувача.

### **GoogleAuthGuard**
перевіряє авторизацію через Google OAuth:
- Використовує `GoogleStrategy` для перевірки токенів.

---

## **Імпорти та залежності**

### **Імпортовані модулі**
- **`PassportModule`**  
  Забезпечує інтеграцію стратегій автентифікації.
- **`JwtModule`**  
  Використовується для роботи з JWT-токенами (генерація та перевірка).
- **`UsersModule`**  
  Забезпечує доступ до функціоналу роботи з користувачами (створення, пошук, оновлення).

### **Експортовані компоненти**
- **AuthService**  
  Експортується для використання в інших модулях.

---

## **Безпека**
Модуль використовує:
- **JWT-токени** для автентифікації та авторизації запитів.
- **Google OAuth** для автентифікації через зовнішній сервіс.



Модуль авторизації забезпечує гнучкість і безпеку системи, дозволяючи користувачам взаємодіяти з платформою як через локальну автентифікацію, так і через інтеграцію з Google.

---
# Модуль користувачів(Users Module):

### Огляд
Модуль користувачів (`UsersModule`) відповідає за управління користувачами в системі. Його основні завдання включають:
- Реєстрацію нових користувачів.
- Зберігання та обробку інформації про користувачів, включаючи хешування паролів.
- Пошук користувачів за різними критеріями, такими як email, ID або Google ID.
- Оновлення інформації про користувачів.

### Компоненти

#### 1. **Entity користувача (`User`)**
Entity користувача описує структуру таблиці в базі даних та містить наступні поля:
- `id`: Унікальний ідентифікатор користувача (генерується автоматично).
- `email`: Унікальний email користувача.
- `username`: Унікальне ім'я користувача.
- `password`: Хешований пароль користувача (може бути `null`, якщо користувач зареєстрований через Google).
- `google_id`: Ідентифікатор Google для користувачів, які авторизуються через Google (може бути `null`).
- `created_at`: Дата створення користувача.

#### 2. **Контролер користувачів (`UsersController`)**
Контролер обробляє HTTP-запити, пов'язані з користувачами. Основний маршрут — `/users`.  
##### Методи:
- **`POST /users/register`**: Реєструє нового користувача, приймаючи `email`, `username` та `password` у тілі запиту.

#### 3. **Сервіс користувачів (`UsersService`)**
Сервіс містить логіку для роботи з користувачами.  
##### Методи:
- **`createUser(email, username, password)`**: Створює нового користувача, хешуючи пароль, якщо він вказаний, і зберігає його в базі даних.
- **`updateUser(user)`**: Оновлює інформацію про користувача.
- **`findByEmail(email)`**: Шукає користувача за email.
- **`findById(id)`**: Шукає користувача за ID.
- **`findByGoogleId(google_id)`**: Шукає користувача за Google ID.

#### 4. **Модуль користувачів (`UsersModule`)**
Основний модуль, який імпортує інші модулі та визначає необхідні залежності.  
##### Імпорти:
- `TypeOrmModule` для роботи з базою даних.  
##### Експорт:
- Сервіс користувачів (`UsersService`) для використання в інших модулях.

### Використані технології
- **TypeORM**: Для роботи з базою даних.
- **bcrypt**: Для хешування паролів.
- **NestJS**: Для побудови модульної архітектури.

### Загальна архітектура
Модуль користувачів інтегрується з іншими модулями, такими як модуль аутентифікації (`AuthModule`), для надання функціональності реєстрації та авторизації.


# Модуль візуальних новел(VisualNovelsModule)

### Огляд
Модуль візуальних новел (`VisualNovelsModule`) забезпечує управління базою даних візуальних новел, включаючи створення, оновлення, видалення та перегляд записів. Він дозволяє фільтрувати новели за жанром і типом, а також надає інтерфейс для взаємодії через REST API.

### Компоненти

#### 1. **Entity візуальної новели (`VisualNovel`)**
Ця Entity визначає модель даних для таблиці `visual_novels` у базі даних:
- `id`: Унікальний ідентифікатор.
- `title`: Назва новели.
- `date`: Дата випуску.
- `image_url`: URL зображення.
- `author`: Автор новели.
- `duration`: Тривалість (у хвилинах).
- `rating`: Рейтинг новели (тип `float`, за замовчуванням 0).
- `description`: Опис новели.
- `torrent_url`: URL до файлу завантаження.
- `type`: Тип новели (наприклад, "роман", "екшен").
- `genre`: Жанр новели.

#### 2. **Контролер візуальних новел (`VisualNovelsController`)**
Контролер обробляє запити до маршруту `/visual-novels`:
##### Методи:
- **`GET /visual-novels`**: Повертає всі новели, з можливістю фільтрації за жанром і типом.
- **`GET /visual-novels/:id`**: Повертає одну новелу за ідентифікатором.
- **`POST /visual-novels`**: Додає нову новелу, використовуючи `CreateVisualNovelDto`.
- **`PATCH /visual-novels/:id`**: Оновлює дані новели за ідентифікатором.
- **`DELETE /visual-novels/:id`**: Видаляє новелу за ідентифікатором.

#### 3. **Сервіс візуальних новел (`VisualNovelsService`)**
Сервіс містить основну логіку:
##### Методи:
- **`findAll(filters)`**: Повертає список новел із застосуванням фільтрів.
- **`findOne(id)`**: Повертає новелу за ідентифікатором.
- **`create(createVisualNovelDto)`**: Створює нову новелу та зберігає її в базі даних.
- **`update(id, updateVisualNovelDto)`**: Оновлює дані новели за ідентифікатором.
- **`remove(id)`**: Видаляє новелу за ідентифікатором.

#### 4. **Модуль візуальних новел (`VisualNovelsModule`)**
Модуль інтегрує всі компоненти:
- Імпортує `TypeOrmModule` для роботи з таблицею `visual_novels`.
- Додає `VisualNovelsController` для обробки HTTP-запитів.
- Додає `VisualNovelsService` для -логіки.

### DTOs

#### `CreateVisualNovelDto`
Використовується для створення нової новели:
- `title`: Назва (обов'язково).
- `date`: Дата випуску (обов'язково).
- Додаткові поля: `image_url`, `author`, `duration`, `rating`, `description`, `torrent_url`, `type`, `genre`.

#### `UpdateVisualNovelDto`
Використовується для оновлення існуючої новели:
- Містить ті ж поля, що й `CreateVisualNovelDto`, але всі вони необов'язкові.

### Технології
- **TypeORM**: Для роботи з базою даних.
- **Class-validator**: Для перевірки вхідних даних.

### Архітектура
Модуль інтегрується з іншими модулями системи, забезпечуючи функціональність додавання, перегляду та управління візуальними новелами.

